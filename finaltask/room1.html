<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="../lib/jquery.min.js"></script>
    <script type="text/javascript" src="../lib/osql.js"></script>

    <script>
        $(document).ready(function () {
            execSelect();
        });
        var yokohamaline = [];


        osql.requireLogin();
        async function execSelect() {
            var objects = await osql.connect('select*from YokohamaLine');
            yokohamaline = [];
            var objects2 = await osql.connect(`select count(station) as x from YokohamaLine;`);
            console.log(objects2);
            var count = Number(objects2[0].x)
            console.log(count);

            for (var i = 0; i < count; i++) {
                yokohamaline[i] = objects[i].station;
                console.log(yokohamaline)
            }

        }
        async function startbutton(){
            //var sql = 'create table Game(username text not null,answer text not null)'
            //await osql.connect(sql);
            var game = await osql.connect('select*from Game');
            var html = "";
            html = html + '<table border="1">';
            for(var i = 0;i<game.length;i++){
                var gameobject = game[i];
                html = html + '<tr>';
                html = html + '<td>' + gameobject.username + '</td>';
                html = html + '<td>' + gameobject.answer + '</td>';
                html = html + '</tr>';
            }
            html = html + '</table>';
            document.getElementById('result').innerHTML = html;
        }


        async function decisionbutton() {

            var answer = document.getElementById('answer').value;
            if (yokohamaline.indexOf(answer) >= 0) {
                console.log("あるよ")
                var sql = `DELETE FROM YokohamaLine WHERE station="${answer}";`
                await osql.connect(sql);
                var name = sessionStorage.getItem('username');
                console.log(name);
                var sql2 = `insert into Game(username,answer)value("${name}","${answer}")`
                await osql.connect(sql2);
                execSelect();
                console.log(yokohamaline)
            }
            else {
                console.log("ないよ")
            }
            
        }



        async function resetbutton() {
            var deletion = `drop table Game;`
            await osql.connect(deletion);
        }

    </script>

</head>

<body>
    <h1>room1</h1>
    <div>
        <button onclick="startbutton()">スタート</button><br>
        解答:<input id="answer" value="" type="textfield">
        <button onclick="decisionbutton()">決定</button>
        <button onclick="resetbutton()">リセット</button>
        <p id = 'result'></p>
    </div>



</body>

</html>